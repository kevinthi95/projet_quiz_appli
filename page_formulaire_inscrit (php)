<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion</title>
    <link rel="stylesheet" type="text/css" href="http://localhost:8888/page_formulaire_inscrit.css">
</head>
<body>

<?php
// Vérifie si le formulaire a été soumis
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Récupère l'e-mail et le mot de passe soumis dans le formulaire
    $email = $_POST['email'];
    $password = $_POST['password'];

    // Vérifie si le fichier des utilisateurs existe
    $file = 'utilisateurs.txt';
    if (file_exists($file)) {
        // Lit chaque ligne du fichier utilisateurs.txt
        $lines = file($file);

        // Parcourt chaque ligne
        foreach ($lines as $line) {
            // Sépare la ligne en colonnes en utilisant le point-virgule comme séparateur
            $columns = explode(';', $line);

            // Vérifie si la première colonne (l'adresse e-mail) correspond à l'e-mail soumis dans le formulaire
            if ($columns[0] === $email) {
                // Vérifie si le mot de passe correspond à celui stocké dans le fichier
                if (trim($columns[1]) === $password) {
                    // Génère un ID unique pour l'utilisateur
                    $id = uniqid();

                    // Modifie la ligne pour ajouter l'ID
                    $line = rtrim($line) . ';' . $id . PHP_EOL;

                    // Ouvre le fichier en mode écriture
                    $fp = fopen($file, 'w');

                    // Écrit les données dans le fichier
                    fwrite($fp, $line);

                    // Ferme le fichier
                    fclose($fp);

                    // Redirige l'utilisateur vers la page principale avec l'ID en paramètre après 5 secondes
                    echo '<script>';
                    echo 'setTimeout(function() { window.location.href = "http://localhost:8888/projetinfo1page_principal.html?id='.$id.'"; }, 5000);';
                    echo '</script>';
                    echo '<div id="message">Connexion réussie. Redirection dans 5 secondes...</div>';
                    exit;
                } else {
                    // Redirige vers la page d'inscription après 5 secondes en cas de mot de passe incorrect
                    echo '<script>';
                    echo 'setTimeout(function() { window.location.href = "http://localhost:8888/page_formulaire_inscrit.php"; }, 5000);';
                    echo '</script>';
                    echo '<div id="message">Mot de passe incorrect. Redirection vers la page d\'inscription dans 5 secondes...</div>';
                    exit;
                }
            }
        }
    }

    // Redirige vers la page d'inscription après 5 secondes si l'e-mail n'est pas trouvé
    echo '<script>';
    echo 'setTimeout(function() { window.location.href = "http://localhost:8888/page_formulaire_inscrit.php"; }, 5000);';
    echo '</script>';
    echo '<div id="message">Vous n\'êtes pas enregistré. Redirection vers la page d\'inscription dans 5 secondes...</div>';
}
?>

<h1>Connexion à votre compte</h1>
<form id="loginForm" method="post">
    <label for="email">Adresse e-mail :</label>
    <input type="email" id="email" name="email" required><br><br>

    <label for="password">Mot de passe :</label>
    <input type="password" id="password" name="password" required><br><br>

    <input type="submit" value="Se connecter"> <br><br>
    <a href="http://localhost:8888/index.php">Créer un nouveau compte</a>
</form>
<div id="message"></div>

<script src="http://localhost:8888/projetinfo1formulaireinscrit.js"></script>

</body>
</html>

